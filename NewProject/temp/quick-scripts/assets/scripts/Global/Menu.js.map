{"version":3,"sources":["Menu.js"],"names":["i18n","require","SceneList","cc","Class","extends","Component","properties","text","default","type","Label","readme","ScrollView","btnInfo","Button","btnBack","testList","uiCamera","Camera","onLoad","_isLoadingScene","showDebugDraw","game","addPersistRootNode","node","currentSceneUrl","contentPos","isMenu","active","loadInstruction","zIndex","content","sceneList","getComponent","init","cocosAnalytics","isInited","CAEvent","onEvent","eventName","systemEvent","on","SystemEvent","EventType","KEY_DOWN","event","keyCode","macro","KEY","b","backToList","_updateInfoButton","director","Director","EVENT_AFTER_SCENE_LAUNCH","_onSceneLaunched","cameras","i","l","length","camera","cullingMask","groupIndex","showReadme","loadScene","onLoadSceneFinish","bind","url","getContentPosition","CALevels","begin","level","setContentPosition","self","urlArr","split","fileName","replace","loader","loadRes","TextAsset","err","asset","string","t","labelTxt","find","textKey","undefined","scrollToTop","enabledDebugDraw","getCollisionManager","videoPlayer","restart","gc","sys","garbageCollect"],"mappings":"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","file":"Menu.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Global","sourcesContent":["const i18n = require('i18n');\nconst SceneList = require('SceneList');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        text: {\n            default: null,\n            type: cc.Label\n        },\n        readme: {\n            default: null,\n            type: cc.ScrollView\n        },\n        btnInfo: {\n            default: null,\n            type: cc.Button\n        },\n        btnBack: {\n            default: null,\n            type: cc.Button\n        },\n        testList: {\n            default: null,\n            type: cc.ScrollView\n        },\n\n        uiCamera: {\n            default: null,\n            type: cc.Camera\n        }\n    },\n\n    onLoad: function () {\n        this._isLoadingScene = true;\n        this.showDebugDraw = false;\n        cc.game.addPersistRootNode(this.node);\n        this.currentSceneUrl = 'TestList.fire';\n        this.contentPos = null;\n        this.isMenu = true;\n        this.btnBack.node.active = false;\n        this.loadInstruction(this.currentSceneUrl);\n        this.node.zIndex = 999;\n\n        cc.game.addPersistRootNode(this.testList.node);\n        if (this.testList && this.testList.content) {\n            // in main scene\n            this.sceneList = this.testList.content.getComponent('SceneList');\n            this.sceneList.init(this);\n        }\n        if (typeof cocosAnalytics !== 'undefined' && cocosAnalytics.isInited && cocosAnalytics.isInited()) {\n            // Cocos Analytics service, to learn more please visit:\n            // https://analytics.cocos.com/docs/\n            cocosAnalytics.CAEvent.onEvent({\n                eventName: \"打开范例\"\n            });\n        }\n\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, (event) => {\n            if (event.keyCode === cc.macro.KEY.b) {\n                this.backToList();\n            }\n        }, this);\n\n        this._updateInfoButton();\n\n        cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH, this._onSceneLaunched, this);\n    },\n\n    _onSceneLaunched () {\n        let cameras = cc.Camera.cameras;\n        for (let i = 0, l = cameras.length; i < l; i++) {\n            let camera = cameras[i];\n            if (camera === this.uiCamera) {\n                camera.cullingMask = 1 << this.node.groupIndex;\n            }\n            else {\n                camera.cullingMask = camera.cullingMask & (~(1 << this.node.groupIndex));\n            }\n        }\n    },\n\n    backToList: function () {\n        if (this._isLoadingScene) {\n            return;\n        }\n        this._isLoadingScene = true;\n        this.showReadme(null, false);\n        this.currentSceneUrl = 'TestList.fire';\n        this.isMenu = true;\n        cc.director.loadScene('TestList', this.onLoadSceneFinish.bind(this));\n    },\n\n    loadScene: function (url) {\n        this._isLoadingScene = true;\n        this.contentPos = this.testList.getContentPosition();\n        this.currentSceneUrl = url;\n        this.isMenu = false;\n        this.testList.node.active = false;\n        cc.director.loadScene(url, this.onLoadSceneFinish.bind(this));\n        if (typeof cocosAnalytics !== 'undefined' && cocosAnalytics.isInited && cocosAnalytics.isInited()) {\n            // Cocos Analytics service, to learn more please visit:\n            // https://analytics.cocos.com/docs/\n            cocosAnalytics.CALevels.begin({\n                level: url\n            });\n        }\n    },\n\n    onLoadSceneFinish: function () {\n        let url = this.currentSceneUrl;\n        this.loadInstruction(url);\n        if (this.isMenu && this.contentPos) {\n            this.btnBack.node.active = false;\n            this.testList.node.active = true;\n            this.testList.setContentPosition(this.contentPos);\n        }\n        else {\n            this.btnBack.node.active = true;\n            this.testList.node.active = false;\n        }\n        this._isLoadingScene = false;\n    },\n\n    loadInstruction: function (url) {\n        let self = this;\n        let urlArr = url.split('/');\n        let fileName = urlArr[urlArr.length - 1].replace('.fire', '');\n        cc.loader.loadRes('readme/' + fileName, cc.TextAsset, function (err, asset) {\n            if (err) {\n                self.text.string = i18n.t(\"scripts/Global/Menu.js.1\");\n                return;\n            }\n            self.text.string = asset.text;\n        });\n    },\n\n    _updateInfoButton: function () {\n        let labelTxt = i18n.t(\"scripts/Global/Menu.js.\" + (this.readme.node.active ? \"view\" : \"hide\") + \".info\");\n        cc.find('label', this.btnInfo.node).getComponent(cc.Label).textKey = labelTxt;\n    },\n\n    showReadme: function (event, active) {\n        if (active === undefined) {\n            this.readme.node.active = !this.readme.node.active;\n        }\n        else {\n            this.readme.node.active = active;\n        }\n        if (this.readme.node.active) {\n            this.readme.scrollToTop();\n        }\n        this._updateInfoButton()\n\n        // en: fix Collider DebugDraw always displayed on top of the problem.\n        // zh：解决 Collider DebugDraw 一直显示在最上层的问题。\n        var enabledDebugDraw = cc.director.getCollisionManager().enabledDebugDraw;\n        if (this.readme.node.active) {\n            this.showDebugDraw = enabledDebugDraw;\n            cc.director.getCollisionManager().enabledDebugDraw = false;\n        }\n        else {\n            cc.director.getCollisionManager().enabledDebugDraw = this.showDebugDraw;\n        }\n        // en: fix Video Player always displayed on top of the problem.\n        // zh：修复 Video Player 一直显示在最上层的问题。\n        var videoPlayer = cc.find('Canvas/VideoPlayer');\n        if (videoPlayer) {\n            videoPlayer.active = !this.readme.node.active;\n        }\n    },\n\n    restart: function () {\n        cc.game.restart();\n    },\n    \n    gc: function () {\n        cc.sys.garbageCollect();\n    }\n});\n"]}