{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\cases\\05_scripting\\11_network/assets\\cases\\05_scripting\\11_network\\DownloaderCtrl.js"],"names":["cc","Class","extends","Component","properties","label","Label","sprite","Sprite","imgUrl","txtUrl","tempImgUrl","_downloader","_imgTask","_txtTask","_storagePath","_inited","onLoad","CC_JSB","string","jsb","Downloader","setOnFileTaskSuccess","onSucceed","bind","setOnTaskProgress","onProgress","setOnTaskError","onError","fileUtils","getWritablePath","createDirectory","task","atlasRelated","requestURL","self","loader","load","storagePath","err","tex","spriteFrame","SpriteFrame","node","active","content","getStringFromFile","substr","bytesReceived","totalBytesReceived","totalBytesExpected","errorCode","errorCodeInternal","errorStr","downloadImg","createDownloadFileTask","loadImg","error","console","log","downloadTxt"],"mappings":"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","file":"DownloaderCtrl.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\cases\\05_scripting\\11_network","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        label: cc.Label,\n        sprite: cc.Sprite,\n        imgUrl: \"http://www.cocos.com/wp-content/themes/cocos/img/download1.png\",\n        txtUrl: \"https://raw.githubusercontent.com/cocos-creator/tutorial-dark-slash/master/LICENSE.md\",\n        tempImgUrl: \"http://www.cocos.com/wp-content/uploads/2018/03/%E9%BB%98%E8%AE%A4%E6%A0%87%E9%A2%98_%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BA%95%E9%83%A8%E4%BA%8C%E7%BB%B4%E7%A0%81_2018.03.08.png\",\n        _downloader: null,\n        _imgTask: null,\n        _txtTask: null,\n        _storagePath: \"\",\n        _inited: false\n    },\n\n    // use this for initialization\n    onLoad () {\n        if (!CC_JSB) {\n            this.label.string = 'Downloader is a NATIVE ONLY feature.';\n            return;\n        }\n\n        this._downloader = new jsb.Downloader();\n        this._downloader.setOnFileTaskSuccess(this.onSucceed.bind(this));\n        this._downloader.setOnTaskProgress(this.onProgress.bind(this));\n        this._downloader.setOnTaskError(this.onError.bind(this));\n\n        this._storagePath = jsb.fileUtils.getWritablePath() + '/example-cases/downloader/';\n        this._inited = jsb.fileUtils.createDirectory(this._storagePath);\n        if (!this._inited) {\n            this.label.string = 'Failed to create storage path, downloader won\\'t work correctly';\n        }\n    },\n\n    onSucceed (task) {\n        var atlasRelated = false;\n        switch (task.requestURL) {\n        case this.imgUrl:\n            var self = this;\n            cc.loader.load(task.storagePath, function (err, tex) {\n                var spriteFrame = new cc.SpriteFrame(tex);\n                self.sprite.spriteFrame = spriteFrame;\n\n                self.sprite.node.active = true;\n                self.label.node.active = false;\n            });\n            break;\n        case this.txtUrl:\n            var content = jsb.fileUtils.getStringFromFile(task.storagePath);\n            this.sprite.node.active = false;\n            this.label.node.active = true;\n            this.label.string = content.substr(0, 350);\n            break;\n        }\n    },\n\n    onProgress (task, bytesReceived, totalBytesReceived, totalBytesExpected) {\n\n    },\n\n    onError (task, errorCode, errorCodeInternal, errorStr) {\n        this.sprite.node.active = false;\n        this.label.node.active = true;\n        this.label.string = 'Failed to download file (' + task.requestURL + '): ' + errorStr + '(' + errorCode + ')';\n    },\n\n    downloadImg () {\n        if (!this.imgUrl || !this._inited) {\n            return;\n        }\n        this._imgTask = this._downloader.createDownloadFileTask(this.imgUrl, this._storagePath + 'download1.png');\n    },\n\n    loadImg () {\n        if (!this.tempImgUrl || !this._inited) {\n            return;\n        }\n        var self = this;\n        cc.loader.load(this.tempImgUrl, function (error, tex) {\n            if (error) {\n                console.log(\"Load remote image failed: \" + error);\n            }\n            else {\n                var spriteFrame = new cc.SpriteFrame(tex);\n                self.sprite.spriteFrame = spriteFrame;\n\n                self.sprite.node.active = true;\n                self.label.node.active = false;\n            }\n        });\n    },\n\n    downloadTxt () {\n        if (!this.txtUrl || !this._inited) {\n            return;\n        }\n        this._txtTask = this._downloader.createDownloadFileTask(this.txtUrl, this._storagePath + 'imagine.txt');\n    }\n});\n"]}